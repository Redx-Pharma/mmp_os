<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />


  <title>MMP.runmmp API documentation</title>
  <meta name="description" content="Module of methods to run MMP analysis, generation and prediction" />


  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>

  <style type="text/css">
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}
</style>
  <style type="text/css">
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  }

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; }

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;

      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/
</style>
  <style type="text/css">
  pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #3D7B7B; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #F00 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666 } /* Operator */
.codehilite .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #9C6500 } /* Comment.Preproc */
.codehilite .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.codehilite .gr { color: #E40000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #008400 } /* Generic.Inserted */
.codehilite .go { color: #717171 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #04D } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #687822 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #00F; font-weight: bold } /* Name.Class */
.codehilite .no { color: #800 } /* Name.Constant */
.codehilite .nd { color: #A2F } /* Name.Decorator */
.codehilite .ni { color: #717171; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #00F } /* Name.Function */
.codehilite .nl { color: #767600 } /* Name.Label */
.codehilite .nn { color: #00F; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #A2F; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #BBB } /* Text.Whitespace */
.codehilite .mb { color: #666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666 } /* Literal.Number.Float */
.codehilite .mh { color: #666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #A45A77 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #00F } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666 } /* Literal.Number.Integer.Long */
  </style>
  <style type="text/css">
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}
</style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>
<div id="container">




















  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3>Super-module</h3>
      <ul>
        <li class="mono"><a href="index.html">MMP</a></li>
      </ul>
    </li>
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>

  <ul>
    <li class="mono"><a href="#MMP.runmmp.log">log</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>

  <ul>
    <li class="mono"><a href="#MMP.runmmp.add_properties">add_properties</a></li>
    <li class="mono"><a href="#MMP.runmmp.generate_and_predict">generate_and_predict</a></li>
    <li class="mono"><a href="#MMP.runmmp.get_modifiers">get_modifiers</a></li>
    <li class="mono"><a href="#MMP.runmmp.get_properties_input">get_properties_input</a></li>
    <li class="mono"><a href="#MMP.runmmp.make_fragements">make_fragements</a></li>
    <li class="mono"><a href="#MMP.runmmp.make_fragements_db">make_fragements_db</a></li>
    <li class="mono"><a href="#MMP.runmmp.setup_mmp">setup_mmp</a></li>
  </ul>

    </li>


    </ul>
  </div>

<article id="content">





  <header id="section-intro">
  <h1 class="title"><span class="name">MMP.runmmp</span> module</h1>
  <p>Module of methods to run MMP analysis, generation and prediction</p>

  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-MMP.runmmp', this);">Show source &equiv;</a></p>
  <div id="source-MMP.runmmp" class="source">
    <div class="codehilite"><pre><span></span><span class="ch">#!/usr/bin.env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module of methods to run MMP analysis, generation and prediction</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">MMP</span><span class="w"> </span><span class="kn">import</span> <span class="n">prep</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">setup_mmp</span><span class="p">(</span>
    <span class="n">csv_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">properties_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">smiles_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;smiles&quot;</span><span class="p">,</span>
    <span class="n">labels_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;labels&quot;</span><span class="p">,</span>
    <span class="n">output_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>
    <span class="n">number_of_cuts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">indexing_output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mmpdb&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to automate from a csv file to MMP fragement and property databases</span>

<span class="sd">    Args:</span>
<span class="sd">        csv_filename (str): The file name of the input csv file containing the raw smiles strings and labels at least. This can be suplemented with properties columns.</span>
<span class="sd">        properties_columns (Optional[List[str]], optional): list of columns headings of properties to include or None to include zero. Defaults to None.</span>
<span class="sd">        smiles_column (str, optional): column heading of the smiles column. Defaults to &quot;smiles&quot;.</span>
<span class="sd">        labels_column (str, optional): column heading of the label column i.e. the identifier for each molecule. Defaults to &quot;labels&quot;.</span>
<span class="sd">        output_filename (str, optional): a name without and extension (i.e. no .xyz) to use to save the files to. Defaults to &quot;data&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None - saves files for future use</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">output_filename</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;ouput filename given with extension. We will remove the extension and save the files using the required extensions&quot;</span>
        <span class="p">)</span>
        <span class="n">output_filename</span> <span class="o">=</span> <span class="n">output_filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># load the data</span>
    <span class="n">raw_df</span> <span class="o">=</span> <span class="n">prep</span><span class="o">.</span><span class="n">load_csv_data</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>

    <span class="c1"># Prepare the data as smiles file for fragmentation</span>
    <span class="n">smi_df</span> <span class="o">=</span> <span class="n">prep</span><span class="o">.</span><span class="n">extract_smiles_and_labels</span><span class="p">(</span>
        <span class="n">raw_df</span><span class="p">,</span> <span class="n">smiles_col</span><span class="o">=</span><span class="n">smiles_column</span><span class="p">,</span> <span class="n">labels_col</span><span class="o">=</span><span class="n">labels_column</span><span class="p">,</span> <span class="n">valid_only</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">smi_df</span><span class="p">[[</span><span class="n">smiles_column</span><span class="p">,</span> <span class="n">labels_column</span><span class="p">]]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.smi&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="c1"># Make the fragment file</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">make_fragements</span><span class="p">(</span>
        <span class="n">input_filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.smi&quot;</span><span class="p">,</span>
        <span class="n">output_filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.fragdb&quot;</span><span class="p">,</span>
        <span class="n">number_of_cuts</span><span class="o">=</span><span class="n">number_of_cuts</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># setup and create the fragment database</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">make_fragements_db</span><span class="p">(</span>
        <span class="n">input_filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.fragdb&quot;</span><span class="p">,</span>
        <span class="n">output_filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">indexing_output_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">output_format</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indexing_output_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">indexing_output_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
        <span class="n">tmp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">indexing_output_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">tmp_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;smiles 1&quot;</span><span class="p">,</span> <span class="s2">&quot;smiles 2&quot;</span><span class="p">,</span> <span class="s2">&quot;id 1&quot;</span><span class="p">,</span> <span class="s2">&quot;id 2&quot;</span><span class="p">,</span> <span class="s2">&quot;v1&gt;&gt;v2&quot;</span><span class="p">,</span> <span class="s2">&quot;constant&quot;</span><span class="p">]</span>
        <span class="n">tmp_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">indexing_output_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Prepare property data files we reload the raw data file here for safety incase there is any chance the object changed from loading before</span>
    <span class="c1"># TODO: determine if the data could have changed and optimize this so we can avoid reloading if the chance is low to none</span>
    <span class="k">if</span> <span class="n">properties_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">raw_df</span> <span class="o">=</span> <span class="n">prep</span><span class="o">.</span><span class="n">load_csv_data</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>
        <span class="n">properties_df</span> <span class="o">=</span> <span class="n">prep</span><span class="o">.</span><span class="n">extract_properties</span><span class="p">(</span>
            <span class="n">raw_df</span><span class="p">,</span>
            <span class="n">properties_columns</span><span class="o">=</span><span class="n">properties_columns</span><span class="p">,</span>
            <span class="n">smiles_col</span><span class="o">=</span><span class="n">smiles_column</span><span class="p">,</span>
            <span class="n">labels_col</span><span class="o">=</span><span class="n">labels_column</span><span class="p">,</span>
            <span class="n">valid_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">properties_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;properties_</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">add_properties</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;properties_</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.mmpdb&quot;</span><span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;MMP set up completed. MMP database: </span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.mmpdb with properties included&quot;</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;MMP set up completed. MMP database: </span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.mmpdb without properties included&quot;</span>
        <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">make_fragements</span><span class="p">(</span>
    <span class="n">input_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">number_of_cuts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CompletedProcess</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build fragment list from smiles</span>

<span class="sd">    Args:</span>
<span class="sd">        input_filename (str): input smiles file</span>
<span class="sd">        output_filename (str): ouput a fragment list file</span>

<span class="sd">    Returns:</span>
<span class="sd">        subprocess.CompletedProcess: The complete process object</span>

<span class="sd">    Raises:</span>
<span class="sd">        CalledProcessError: If there is an error in running the code a raise of CalledProcessError is made with more details of issue</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;mmpdb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fragment&quot;</span><span class="p">,</span>
            <span class="n">input_filename</span><span class="p">,</span>
            <span class="s2">&quot;--num-cuts&quot;</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">number_of_cuts</span><span class="p">),</span>
            <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
            <span class="n">output_filename</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">ret</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Command completed successfully with return code </span><span class="si">{</span><span class="n">ret</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">. Fragment file saved as </span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Command output:</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="s2">&quot;ERROR - Command returned a non-zero exit code. It has likely failed! Please check you command and input carefully.&quot;</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">ret</span>


<span class="k">def</span><span class="w"> </span><span class="nf">make_fragements_db</span><span class="p">(</span>
    <span class="n">input_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mmpdb&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CompletedProcess</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build fragment database from a fragment list file (see make_fragements for the fragment list file)</span>

<span class="sd">    Args:</span>
<span class="sd">        input_filename (str): input smiles file</span>
<span class="sd">        output_filename (str): ouput a fragment pre database file</span>

<span class="sd">    Returns:</span>
<span class="sd">        subprocess.CompletedProcess: The complete process object</span>

<span class="sd">    Raises:</span>
<span class="sd">        CalledProcessError: If there is an error in running the code a raise of CalledProcessError is made with more details of issue</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;mmpdb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;index&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--out&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--symmetric&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">ret</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Command completed successfully with return code </span><span class="si">{</span><span class="n">ret</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">. MMP database saved as </span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Command output:</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="s2">&quot;ERROR - Command returned a non-zero exit code. It has likely failed! Please check you command and input carefully.&quot;</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">ret</span>


<span class="k">def</span><span class="w"> </span><span class="nf">add_properties</span><span class="p">(</span>
    <span class="n">input_properties_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CompletedProcess</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add properties fields to the database which in turn enable predictions of property shifts</span>

<span class="sd">    Args:</span>
<span class="sd">        input_filename (str): input property file</span>
<span class="sd">        database_name (str): The name of the database to add the properties to</span>

<span class="sd">    Returns:</span>
<span class="sd">        subprocess.CompletedProcess: The complete process object</span>

<span class="sd">    Raises:</span>
<span class="sd">        CalledProcessError: If there is an error in running the code a raise of CalledProcessError is made with more details of issue</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;mmpdb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;loadprops&quot;</span><span class="p">,</span>
            <span class="n">database_name</span><span class="p">,</span>
            <span class="s2">&quot;--properties&quot;</span><span class="p">,</span>
            <span class="n">input_properties_filename</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">ret</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Command completed successfully with return code </span><span class="si">{</span><span class="n">ret</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">. Properties added to MMP database </span><span class="si">{</span><span class="n">database_name</span><span class="si">}</span><span class="s2"> from properties file </span><span class="si">{</span><span class="n">input_properties_filename</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Command output:</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="s2">&quot;ERROR - Command returned a non-zero exit code. It has likely failed! Please check you command and input carefully.&quot;</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">ret</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_properties_input</span><span class="p">(</span>
    <span class="n">properties_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
    <span class="n">property_flag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;--property&quot;</span><span class="p">,</span>
    <span class="n">no_property_flag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;--no-properties&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get the property choice commandline arguments</span>

<span class="sd">    Args:</span>
<span class="sd">        properties_list (Union[str, List[str]]): The properties to predict the shift in values of if any.</span>
<span class="sd">        The properties should be passed either as a python list or comma separated string (i.e. &#39;MW,Logp,LogS,Natoms&#39;).</span>
<span class="sd">        Alternatively pass &#39;none&#39; to predict no properties or use the default &#39;all&#39; to predict all known properties.</span>
<span class="sd">        Defaults to None which means predict all properties.</span>
<span class="sd">        property_flag (str, optional): The command line flag to specify a property. Defaults to &quot;--property&quot;.</span>
<span class="sd">        no_property_flag (str, optional): The command line flag to not predict properties. Defaults to &quot;--no-properties&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: The commandline arguments and variables for specifitying the properties to predict if any as a python list</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># determine properties to predict or none</span>
    <span class="c1"># First case: pass in a string &#39;all&#39;, &#39;none&#39; (both case insenitive) or a comma separated list of properties to predict all known properties,</span>
    <span class="c1"># no properties or just the listed properties respectively. This interface is more for non-programatic interaction allowing strings to be</span>
    <span class="c1"># passed for all cases</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">properties_list</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">properties_list</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Predicting all known properties&quot;</span><span class="p">)</span>
            <span class="n">props</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">properties_list</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Predicting no known properties&quot;</span><span class="p">)</span>
            <span class="n">props</span> <span class="o">=</span> <span class="p">[</span><span class="n">no_property_flag</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">properties_list</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Predicting user selected known properties&quot;</span><span class="p">)</span>
            <span class="n">properties_list</span> <span class="o">=</span> <span class="n">properties_list</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">props</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties_list</span><span class="p">:</span>
                <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">property_flag</span><span class="p">)</span>
                <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="c1"># Second case: pass in the python keyword None to make no property predictions</span>
    <span class="k">elif</span> <span class="n">properties_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Predicting no known properties&quot;</span><span class="p">)</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">[</span><span class="n">no_property_flag</span><span class="p">]</span>

    <span class="c1"># Third case: pass in a python iterable of properties</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Predicting user selected known properties&quot;</span><span class="p">)</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties_list</span><span class="p">:</span>
            <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">property_flag</span><span class="p">)</span>
            <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">props</span>


<span class="c1"># TODO: this could be more generic with **kwargs test if this better or not</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_modifiers</span><span class="p">(</span>
    <span class="n">min_variable_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_variable_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_constant_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_constant_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_radius</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_pairs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">substructure</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">explain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prepare arguments for the transformation function as modifications of the default method</span>

<span class="sd">    Args:</span>
<span class="sd">        min_variable_size (Optional[int], optional): The minimum size in number of heavy atoms (non-hydrogen) to be added to a scaffold. Defaults to None meaning 0.</span>
<span class="sd">        max_variable_size (Optional[int], optional): The maximumsize in number of heavy atoms (non-hydrogen) to be added to a scaffold. Defaults to None meaning 999.</span>
<span class="sd">        min_constant_size (Optional[int], optional): The minimum size in number of heavy atoms (non-hydrogen) for a fragment to be considered a scaffold. Defaults to None meaning 0.</span>
<span class="sd">        max_constant_size (Optional[int], optional): The miaximum size in number of heavy atoms (non-hydrogen) for a fragment to be considered a scaffold. Defaults to None meaning 9999.</span>
<span class="sd">        min_radius (Optional[int], optional): The minimum environment radius around a connection site (in number of bonds) which should match for a connection to be made. Defaults to None meaning 0.</span>
<span class="sd">        min_pairs (Optional[int], optional): The minimum number of matched pairs (support) which needs to be reached to consider the use of a MMP rule. Defaults to None meaning 0.</span>
<span class="sd">        substructure (Optional[str], optional): A fixed substructure written in SMARTS which must be present to consider the transform valid. Defaults to None.</span>
<span class="sd">        explain (bool, optional): Provided limited SMARTS based explanations for the transformations. Defaults to False**kwargs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># The arguments to this function are the same names as for the commandline of MMPDB with - changed to _ for python syntax</span>
    <span class="c1"># In this function if any of these modifiers are set we prepare the commandline version by prepending -- and changing _ to - in the rest of the argument name</span>
    <span class="c1"># Must be first otherwise stores other local variables</span>
    <span class="n">inps</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="n">modifiers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inps</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;--</span><span class="si">{</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">modifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="n">modifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">modifiers</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_and_predict</span><span class="p">(</span>
    <span class="n">smiles</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">properties_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">min_variable_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_variable_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_constant_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_constant_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_radius</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_pairs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">substructure</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">explain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate new smiles and predict the shift in the properties requested. Note the properties must exist in the database already. Please</span>
<span class="sd">    note that the models used to predict the shift are based on group contribution where the changes are large from the base molecules i.e.</span>
<span class="sd">    the known molecule these predictions can be very poor.</span>

<span class="sd">    Args:</span>
<span class="sd">        smiles (str): The smiles string base to transform and identify new possible molecules</span>
<span class="sd">        database (str): The MMP data base with reaction based conversion rules and properties</span>
<span class="sd">        properties_list (Union[str, List[str]]): The properties to predict the shift in values of if any.</span>
<span class="sd">        The properties should be passed either as a python list or comma separated string (i.e. &#39;MW,Logp,LogS,Natoms&#39;).</span>
<span class="sd">        Alternatively pass &#39;none&#39; to predict no properties or use the default &#39;all&#39; to predict all known properties.</span>
<span class="sd">        Defaults to None which means predict all properties.</span>
<span class="sd">        min_variable_size (Optional[int], optional): The minimum size in number of heavy atoms (non-hydrogen) to be added to a scaffold. Defaults to None meaning 0.</span>
<span class="sd">        max_variable_size (Optional[int], optional): The maximumsize in number of heavy atoms (non-hydrogen) to be added to a scaffold. Defaults to None meaning 999.</span>
<span class="sd">        min_constant_size (Optional[int], optional): The minimum size in number of heavy atoms (non-hydrogen) for a fragment to be considered a scaffold. Defaults to None meaning 0.</span>
<span class="sd">        max_constant_size (Optional[int], optional): The miaximum size in number of heavy atoms (non-hydrogen) for a fragment to be considered a scaffold. Defaults to None meaning 9999.</span>
<span class="sd">        min_radius (Optional[int], optional): The minimum environment radius around a connection site (in number of bonds) which should match for a connection to be made. Defaults to None meaning 0.</span>
<span class="sd">        min_pairs (Optional[int], optional): The minimum number of matched pairs (support) which needs to be reached to consider the use of a MMP rule. Defaults to None meaning 0.</span>
<span class="sd">        substructure (Optional[str], optional): A fixed substructure written in SMARTS which must be present to consider the transform valid. Defaults to None.</span>
<span class="sd">        explain (bool, optional): Provided limited SMARTS based explanations for the transformations. Defaults to False**kwargs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: The data frame of the generated molecules and predicted shifts</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">props</span> <span class="o">=</span> <span class="n">get_properties_input</span><span class="p">(</span><span class="n">properties_list</span><span class="o">=</span><span class="n">properties_list</span><span class="p">)</span>

    <span class="n">modifiers</span> <span class="o">=</span> <span class="n">get_modifiers</span><span class="p">(</span>
        <span class="n">min_variable_size</span><span class="p">,</span>
        <span class="n">max_variable_size</span><span class="p">,</span>
        <span class="n">min_constant_size</span><span class="p">,</span>
        <span class="n">max_constant_size</span><span class="p">,</span>
        <span class="n">min_radius</span><span class="p">,</span>
        <span class="n">min_pairs</span><span class="p">,</span>
        <span class="n">substructure</span><span class="p">,</span>
        <span class="n">explain</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;mmpdb&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;transform&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">database</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;--smiles&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">smiles</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">modifiers</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">props</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;mmpdb&quot;</span><span class="p">,</span> <span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="s2">&quot;--smiles&quot;</span><span class="p">,</span> <span class="n">smiles</span><span class="p">,</span> <span class="o">*</span><span class="n">modifiers</span><span class="p">,</span> <span class="o">*</span><span class="n">props</span><span class="p">],</span>
        <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">ret</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Command completed successfully with return code </span><span class="si">{</span><span class="n">ret</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Command output:</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="s2">&quot;ERROR - Command returned a non-zero exit code. It has likely failed! Please check you command and input carefully.&quot;</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">transform_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()),</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">transform_df</span>


<span class="c1"># def generate()</span>
<span class="c1">#     ret = subprocess.run([&quot;mmpdb&quot;, &quot;transform&quot;, &quot;data.mmpdb&quot;, &quot;--smiles&quot;, new_smiles, &quot;--property&quot;, &quot;prop1(madeup)&quot;], check=True, capture_output = True, shell=False)</span>
<span class="c1">#     if ret.returncode == 0:</span>
<span class="c1">#         log.info(f&quot;Command completed successfully with return code {ret.returncode}&quot;)</span>
<span class="c1">#     else:</span>
<span class="c1">#         log.critical(&quot;ERROR - Command returned a non-zero exit code. It has likely failed! Please check you command and input carefully.&quot;)</span>

<span class="c1"># def predict()</span>
<span class="c1">#     ret = subprocess.run([&quot;mmpdb&quot;, &quot;transform&quot;, &quot;data.mmpdb&quot;, &quot;--smiles&quot;, new_smiles, &quot;--property&quot;, &quot;prop1(madeup)&quot;], check=True, capture_output = True, shell=False)</span>
<span class="c1">#     if ret.returncode == 0:</span>
<span class="c1">#         log.info(f&quot;Command completed successfully with return code {ret.returncode}&quot;)</span>
<span class="c1">#     else:</span>
<span class="c1">#         log.critical(&quot;ERROR - Command returned a non-zero exit code. It has likely failed! Please check you command and input carefully.&quot;)</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="MMP.runmmp.log" class="name">var <span class="ident">log</span></p>


  <div class="source_cont">
</div>

      </div>

    <h2 class="section-title" id="header-functions">Functions</h2>

  <div class="item">
    <div class="name def" id="MMP.runmmp.add_properties">
    <p>def <span class="ident">add_properties</span>(</p><p>input_properties_filename: str, database_name: str)</p>
    </div>




    <div class="desc"><p>Add properties fields to the database which in turn enable predictions of property shifts</p>
<p>Args:
    input_filename (str): input property file
    database_name (str): The name of the database to add the properties to</p>
<p>Returns:
    subprocess.CompletedProcess: The complete process object</p>
<p>Raises:
    CalledProcessError: If there is an error in running the code a raise of CalledProcessError is made with more details of issue</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-MMP.runmmp.add_properties', this);">Show source &equiv;</a></p>
  <div id="source-MMP.runmmp.add_properties" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">add_properties</span><span class="p">(</span>
    <span class="n">input_properties_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CompletedProcess</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add properties fields to the database which in turn enable predictions of property shifts</span>

<span class="sd">    Args:</span>
<span class="sd">        input_filename (str): input property file</span>
<span class="sd">        database_name (str): The name of the database to add the properties to</span>

<span class="sd">    Returns:</span>
<span class="sd">        subprocess.CompletedProcess: The complete process object</span>

<span class="sd">    Raises:</span>
<span class="sd">        CalledProcessError: If there is an error in running the code a raise of CalledProcessError is made with more details of issue</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;mmpdb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;loadprops&quot;</span><span class="p">,</span>
            <span class="n">database_name</span><span class="p">,</span>
            <span class="s2">&quot;--properties&quot;</span><span class="p">,</span>
            <span class="n">input_properties_filename</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">ret</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Command completed successfully with return code </span><span class="si">{</span><span class="n">ret</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">. Properties added to MMP database </span><span class="si">{</span><span class="n">database_name</span><span class="si">}</span><span class="s2"> from properties file </span><span class="si">{</span><span class="n">input_properties_filename</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Command output:</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="s2">&quot;ERROR - Command returned a non-zero exit code. It has likely failed! Please check you command and input carefully.&quot;</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">ret</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="MMP.runmmp.generate_and_predict">
    <p>def <span class="ident">generate_and_predict</span>(</p><p>smiles: str, database: str, properties_list: Union[str, List[str], NoneType] = &#39;all&#39;, min_variable_size: Optional[int] = None, max_variable_size: Optional[int] = None, min_constant_size: Optional[int] = None, max_constant_size: Optional[int] = None, min_radius: Optional[int] = None, min_pairs: Optional[int] = None, substructure: Optional[str] = None, explain: bool = False, **kwargs)</p>
    </div>




    <div class="desc"><p>Generate new smiles and predict the shift in the properties requested. Note the properties must exist in the database already. Please
note that the models used to predict the shift are based on group contribution where the changes are large from the base molecules i.e.
the known molecule these predictions can be very poor.</p>
<p>Args:
    smiles (str): The smiles string base to transform and identify new possible molecules
    database (str): The MMP data base with reaction based conversion rules and properties
    properties_list (Union[str, List[str]]): The properties to predict the shift in values of if any.
    The properties should be passed either as a python list or comma separated string (i.e. 'MW,Logp,LogS,Natoms').
    Alternatively pass 'none' to predict no properties or use the default 'all' to predict all known properties.
    Defaults to None which means predict all properties.
    min_variable_size (Optional[int], optional): The minimum size in number of heavy atoms (non-hydrogen) to be added to a scaffold. Defaults to None meaning 0.
    max_variable_size (Optional[int], optional): The maximumsize in number of heavy atoms (non-hydrogen) to be added to a scaffold. Defaults to None meaning 999.
    min_constant_size (Optional[int], optional): The minimum size in number of heavy atoms (non-hydrogen) for a fragment to be considered a scaffold. Defaults to None meaning 0.
    max_constant_size (Optional[int], optional): The miaximum size in number of heavy atoms (non-hydrogen) for a fragment to be considered a scaffold. Defaults to None meaning 9999.
    min_radius (Optional[int], optional): The minimum environment radius around a connection site (in number of bonds) which should match for a connection to be made. Defaults to None meaning 0.
    min_pairs (Optional[int], optional): The minimum number of matched pairs (support) which needs to be reached to consider the use of a MMP rule. Defaults to None meaning 0.
    substructure (Optional[str], optional): A fixed substructure written in SMARTS which must be present to consider the transform valid. Defaults to None.
    explain (bool, optional): Provided limited SMARTS based explanations for the transformations. Defaults to False**kwargs.</p>
<p>Returns:
    pd.DataFrame: The data frame of the generated molecules and predicted shifts</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-MMP.runmmp.generate_and_predict', this);">Show source &equiv;</a></p>
  <div id="source-MMP.runmmp.generate_and_predict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">generate_and_predict</span><span class="p">(</span>
    <span class="n">smiles</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">properties_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">min_variable_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_variable_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_constant_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_constant_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_radius</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_pairs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">substructure</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">explain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate new smiles and predict the shift in the properties requested. Note the properties must exist in the database already. Please</span>
<span class="sd">    note that the models used to predict the shift are based on group contribution where the changes are large from the base molecules i.e.</span>
<span class="sd">    the known molecule these predictions can be very poor.</span>

<span class="sd">    Args:</span>
<span class="sd">        smiles (str): The smiles string base to transform and identify new possible molecules</span>
<span class="sd">        database (str): The MMP data base with reaction based conversion rules and properties</span>
<span class="sd">        properties_list (Union[str, List[str]]): The properties to predict the shift in values of if any.</span>
<span class="sd">        The properties should be passed either as a python list or comma separated string (i.e. &#39;MW,Logp,LogS,Natoms&#39;).</span>
<span class="sd">        Alternatively pass &#39;none&#39; to predict no properties or use the default &#39;all&#39; to predict all known properties.</span>
<span class="sd">        Defaults to None which means predict all properties.</span>
<span class="sd">        min_variable_size (Optional[int], optional): The minimum size in number of heavy atoms (non-hydrogen) to be added to a scaffold. Defaults to None meaning 0.</span>
<span class="sd">        max_variable_size (Optional[int], optional): The maximumsize in number of heavy atoms (non-hydrogen) to be added to a scaffold. Defaults to None meaning 999.</span>
<span class="sd">        min_constant_size (Optional[int], optional): The minimum size in number of heavy atoms (non-hydrogen) for a fragment to be considered a scaffold. Defaults to None meaning 0.</span>
<span class="sd">        max_constant_size (Optional[int], optional): The miaximum size in number of heavy atoms (non-hydrogen) for a fragment to be considered a scaffold. Defaults to None meaning 9999.</span>
<span class="sd">        min_radius (Optional[int], optional): The minimum environment radius around a connection site (in number of bonds) which should match for a connection to be made. Defaults to None meaning 0.</span>
<span class="sd">        min_pairs (Optional[int], optional): The minimum number of matched pairs (support) which needs to be reached to consider the use of a MMP rule. Defaults to None meaning 0.</span>
<span class="sd">        substructure (Optional[str], optional): A fixed substructure written in SMARTS which must be present to consider the transform valid. Defaults to None.</span>
<span class="sd">        explain (bool, optional): Provided limited SMARTS based explanations for the transformations. Defaults to False**kwargs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: The data frame of the generated molecules and predicted shifts</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">props</span> <span class="o">=</span> <span class="n">get_properties_input</span><span class="p">(</span><span class="n">properties_list</span><span class="o">=</span><span class="n">properties_list</span><span class="p">)</span>

    <span class="n">modifiers</span> <span class="o">=</span> <span class="n">get_modifiers</span><span class="p">(</span>
        <span class="n">min_variable_size</span><span class="p">,</span>
        <span class="n">max_variable_size</span><span class="p">,</span>
        <span class="n">min_constant_size</span><span class="p">,</span>
        <span class="n">max_constant_size</span><span class="p">,</span>
        <span class="n">min_radius</span><span class="p">,</span>
        <span class="n">min_pairs</span><span class="p">,</span>
        <span class="n">substructure</span><span class="p">,</span>
        <span class="n">explain</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;mmpdb&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;transform&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">database</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;--smiles&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">smiles</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">modifiers</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">props</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;mmpdb&quot;</span><span class="p">,</span> <span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="s2">&quot;--smiles&quot;</span><span class="p">,</span> <span class="n">smiles</span><span class="p">,</span> <span class="o">*</span><span class="n">modifiers</span><span class="p">,</span> <span class="o">*</span><span class="n">props</span><span class="p">],</span>
        <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">ret</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Command completed successfully with return code </span><span class="si">{</span><span class="n">ret</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Command output:</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="s2">&quot;ERROR - Command returned a non-zero exit code. It has likely failed! Please check you command and input carefully.&quot;</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">transform_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()),</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">transform_df</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="MMP.runmmp.get_modifiers">
    <p>def <span class="ident">get_modifiers</span>(</p><p>min_variable_size: Optional[int] = None, max_variable_size: Optional[int] = None, min_constant_size: Optional[int] = None, max_constant_size: Optional[int] = None, min_radius: Optional[int] = None, min_pairs: Optional[int] = None, substructure: Optional[str] = None, explain: bool = False)</p>
    </div>




    <div class="desc"><p>Prepare arguments for the transformation function as modifications of the default method</p>
<p>Args:
    min_variable_size (Optional[int], optional): The minimum size in number of heavy atoms (non-hydrogen) to be added to a scaffold. Defaults to None meaning 0.
    max_variable_size (Optional[int], optional): The maximumsize in number of heavy atoms (non-hydrogen) to be added to a scaffold. Defaults to None meaning 999.
    min_constant_size (Optional[int], optional): The minimum size in number of heavy atoms (non-hydrogen) for a fragment to be considered a scaffold. Defaults to None meaning 0.
    max_constant_size (Optional[int], optional): The miaximum size in number of heavy atoms (non-hydrogen) for a fragment to be considered a scaffold. Defaults to None meaning 9999.
    min_radius (Optional[int], optional): The minimum environment radius around a connection site (in number of bonds) which should match for a connection to be made. Defaults to None meaning 0.
    min_pairs (Optional[int], optional): The minimum number of matched pairs (support) which needs to be reached to consider the use of a MMP rule. Defaults to None meaning 0.
    substructure (Optional[str], optional): A fixed substructure written in SMARTS which must be present to consider the transform valid. Defaults to None.
    explain (bool, optional): Provided limited SMARTS based explanations for the transformations. Defaults to False**kwargs.</p>
<p>Returns:
    List: <em>description</em></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-MMP.runmmp.get_modifiers', this);">Show source &equiv;</a></p>
  <div id="source-MMP.runmmp.get_modifiers" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_modifiers</span><span class="p">(</span>
    <span class="n">min_variable_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_variable_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_constant_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_constant_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_radius</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_pairs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">substructure</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">explain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prepare arguments for the transformation function as modifications of the default method</span>

<span class="sd">    Args:</span>
<span class="sd">        min_variable_size (Optional[int], optional): The minimum size in number of heavy atoms (non-hydrogen) to be added to a scaffold. Defaults to None meaning 0.</span>
<span class="sd">        max_variable_size (Optional[int], optional): The maximumsize in number of heavy atoms (non-hydrogen) to be added to a scaffold. Defaults to None meaning 999.</span>
<span class="sd">        min_constant_size (Optional[int], optional): The minimum size in number of heavy atoms (non-hydrogen) for a fragment to be considered a scaffold. Defaults to None meaning 0.</span>
<span class="sd">        max_constant_size (Optional[int], optional): The miaximum size in number of heavy atoms (non-hydrogen) for a fragment to be considered a scaffold. Defaults to None meaning 9999.</span>
<span class="sd">        min_radius (Optional[int], optional): The minimum environment radius around a connection site (in number of bonds) which should match for a connection to be made. Defaults to None meaning 0.</span>
<span class="sd">        min_pairs (Optional[int], optional): The minimum number of matched pairs (support) which needs to be reached to consider the use of a MMP rule. Defaults to None meaning 0.</span>
<span class="sd">        substructure (Optional[str], optional): A fixed substructure written in SMARTS which must be present to consider the transform valid. Defaults to None.</span>
<span class="sd">        explain (bool, optional): Provided limited SMARTS based explanations for the transformations. Defaults to False**kwargs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># The arguments to this function are the same names as for the commandline of MMPDB with - changed to _ for python syntax</span>
    <span class="c1"># In this function if any of these modifiers are set we prepare the commandline version by prepending -- and changing _ to - in the rest of the argument name</span>
    <span class="c1"># Must be first otherwise stores other local variables</span>
    <span class="n">inps</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="n">modifiers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inps</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;--</span><span class="si">{</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">modifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="n">modifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">modifiers</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="MMP.runmmp.get_properties_input">
    <p>def <span class="ident">get_properties_input</span>(</p><p>properties_list: Union[str, List[str], NoneType], property_flag: str = &#39;--property&#39;, no_property_flag: str = &#39;--no-properties&#39;)</p>
    </div>




    <div class="desc"><p>get the property choice commandline arguments</p>
<p>Args:
    properties_list (Union[str, List[str]]): The properties to predict the shift in values of if any.
    The properties should be passed either as a python list or comma separated string (i.e. 'MW,Logp,LogS,Natoms').
    Alternatively pass 'none' to predict no properties or use the default 'all' to predict all known properties.
    Defaults to None which means predict all properties.
    property_flag (str, optional): The command line flag to specify a property. Defaults to "&ndash;property".
    no_property_flag (str, optional): The command line flag to not predict properties. Defaults to "&ndash;no-properties".</p>
<p>Returns:
    List[str]: The commandline arguments and variables for specifitying the properties to predict if any as a python list</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-MMP.runmmp.get_properties_input', this);">Show source &equiv;</a></p>
  <div id="source-MMP.runmmp.get_properties_input" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_properties_input</span><span class="p">(</span>
    <span class="n">properties_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
    <span class="n">property_flag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;--property&quot;</span><span class="p">,</span>
    <span class="n">no_property_flag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;--no-properties&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get the property choice commandline arguments</span>

<span class="sd">    Args:</span>
<span class="sd">        properties_list (Union[str, List[str]]): The properties to predict the shift in values of if any.</span>
<span class="sd">        The properties should be passed either as a python list or comma separated string (i.e. &#39;MW,Logp,LogS,Natoms&#39;).</span>
<span class="sd">        Alternatively pass &#39;none&#39; to predict no properties or use the default &#39;all&#39; to predict all known properties.</span>
<span class="sd">        Defaults to None which means predict all properties.</span>
<span class="sd">        property_flag (str, optional): The command line flag to specify a property. Defaults to &quot;--property&quot;.</span>
<span class="sd">        no_property_flag (str, optional): The command line flag to not predict properties. Defaults to &quot;--no-properties&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: The commandline arguments and variables for specifitying the properties to predict if any as a python list</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># determine properties to predict or none</span>
    <span class="c1"># First case: pass in a string &#39;all&#39;, &#39;none&#39; (both case insenitive) or a comma separated list of properties to predict all known properties,</span>
    <span class="c1"># no properties or just the listed properties respectively. This interface is more for non-programatic interaction allowing strings to be</span>
    <span class="c1"># passed for all cases</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">properties_list</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">properties_list</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Predicting all known properties&quot;</span><span class="p">)</span>
            <span class="n">props</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">properties_list</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Predicting no known properties&quot;</span><span class="p">)</span>
            <span class="n">props</span> <span class="o">=</span> <span class="p">[</span><span class="n">no_property_flag</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">properties_list</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Predicting user selected known properties&quot;</span><span class="p">)</span>
            <span class="n">properties_list</span> <span class="o">=</span> <span class="n">properties_list</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">props</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties_list</span><span class="p">:</span>
                <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">property_flag</span><span class="p">)</span>
                <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="c1"># Second case: pass in the python keyword None to make no property predictions</span>
    <span class="k">elif</span> <span class="n">properties_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Predicting no known properties&quot;</span><span class="p">)</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">[</span><span class="n">no_property_flag</span><span class="p">]</span>

    <span class="c1"># Third case: pass in a python iterable of properties</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Predicting user selected known properties&quot;</span><span class="p">)</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties_list</span><span class="p">:</span>
            <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">property_flag</span><span class="p">)</span>
            <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">props</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="MMP.runmmp.make_fragements">
    <p>def <span class="ident">make_fragements</span>(</p><p>input_filename: str, output_filename: str, number_of_cuts: int = 3)</p>
    </div>




    <div class="desc"><p>Build fragment list from smiles</p>
<p>Args:
    input_filename (str): input smiles file
    output_filename (str): ouput a fragment list file</p>
<p>Returns:
    subprocess.CompletedProcess: The complete process object</p>
<p>Raises:
    CalledProcessError: If there is an error in running the code a raise of CalledProcessError is made with more details of issue</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-MMP.runmmp.make_fragements', this);">Show source &equiv;</a></p>
  <div id="source-MMP.runmmp.make_fragements" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">make_fragements</span><span class="p">(</span>
    <span class="n">input_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">number_of_cuts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CompletedProcess</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build fragment list from smiles</span>

<span class="sd">    Args:</span>
<span class="sd">        input_filename (str): input smiles file</span>
<span class="sd">        output_filename (str): ouput a fragment list file</span>

<span class="sd">    Returns:</span>
<span class="sd">        subprocess.CompletedProcess: The complete process object</span>

<span class="sd">    Raises:</span>
<span class="sd">        CalledProcessError: If there is an error in running the code a raise of CalledProcessError is made with more details of issue</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;mmpdb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fragment&quot;</span><span class="p">,</span>
            <span class="n">input_filename</span><span class="p">,</span>
            <span class="s2">&quot;--num-cuts&quot;</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">number_of_cuts</span><span class="p">),</span>
            <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
            <span class="n">output_filename</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">ret</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Command completed successfully with return code </span><span class="si">{</span><span class="n">ret</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">. Fragment file saved as </span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Command output:</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="s2">&quot;ERROR - Command returned a non-zero exit code. It has likely failed! Please check you command and input carefully.&quot;</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">ret</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="MMP.runmmp.make_fragements_db">
    <p>def <span class="ident">make_fragements_db</span>(</p><p>input_filename: str, output_filename: str, output_format: str = &#39;mmpdb&#39;)</p>
    </div>




    <div class="desc"><p>Build fragment database from a fragment list file (see make_fragements for the fragment list file)</p>
<p>Args:
    input_filename (str): input smiles file
    output_filename (str): ouput a fragment pre database file</p>
<p>Returns:
    subprocess.CompletedProcess: The complete process object</p>
<p>Raises:
    CalledProcessError: If there is an error in running the code a raise of CalledProcessError is made with more details of issue</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-MMP.runmmp.make_fragements_db', this);">Show source &equiv;</a></p>
  <div id="source-MMP.runmmp.make_fragements_db" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">make_fragements_db</span><span class="p">(</span>
    <span class="n">input_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mmpdb&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CompletedProcess</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build fragment database from a fragment list file (see make_fragements for the fragment list file)</span>

<span class="sd">    Args:</span>
<span class="sd">        input_filename (str): input smiles file</span>
<span class="sd">        output_filename (str): ouput a fragment pre database file</span>

<span class="sd">    Returns:</span>
<span class="sd">        subprocess.CompletedProcess: The complete process object</span>

<span class="sd">    Raises:</span>
<span class="sd">        CalledProcessError: If there is an error in running the code a raise of CalledProcessError is made with more details of issue</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;mmpdb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;index&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--out&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--symmetric&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">ret</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Command completed successfully with return code </span><span class="si">{</span><span class="n">ret</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">. MMP database saved as </span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Command output:</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="s2">&quot;ERROR - Command returned a non-zero exit code. It has likely failed! Please check you command and input carefully.&quot;</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}{</span><span class="n">ret</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">ret</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="MMP.runmmp.setup_mmp">
    <p>def <span class="ident">setup_mmp</span>(</p><p>csv_filename: str, properties_columns: Optional[List[str]] = None, smiles_column: str = &#39;smiles&#39;, labels_column: str = &#39;labels&#39;, output_filename: str = &#39;data&#39;, number_of_cuts: int = 3, indexing_output_format: str = &#39;mmpdb&#39;)</p>
    </div>




    <div class="desc"><p>Function to automate from a csv file to MMP fragement and property databases</p>
<p>Args:
    csv_filename (str): The file name of the input csv file containing the raw smiles strings and labels at least. This can be suplemented with properties columns.
    properties_columns (Optional[List[str]], optional): list of columns headings of properties to include or None to include zero. Defaults to None.
    smiles_column (str, optional): column heading of the smiles column. Defaults to "smiles".
    labels_column (str, optional): column heading of the label column i.e. the identifier for each molecule. Defaults to "labels".
    output_filename (str, optional): a name without and extension (i.e. no .xyz) to use to save the files to. Defaults to "data".</p>
<p>Returns:
    None - saves files for future use</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-MMP.runmmp.setup_mmp', this);">Show source &equiv;</a></p>
  <div id="source-MMP.runmmp.setup_mmp" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">setup_mmp</span><span class="p">(</span>
    <span class="n">csv_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">properties_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">smiles_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;smiles&quot;</span><span class="p">,</span>
    <span class="n">labels_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;labels&quot;</span><span class="p">,</span>
    <span class="n">output_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>
    <span class="n">number_of_cuts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">indexing_output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mmpdb&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to automate from a csv file to MMP fragement and property databases</span>

<span class="sd">    Args:</span>
<span class="sd">        csv_filename (str): The file name of the input csv file containing the raw smiles strings and labels at least. This can be suplemented with properties columns.</span>
<span class="sd">        properties_columns (Optional[List[str]], optional): list of columns headings of properties to include or None to include zero. Defaults to None.</span>
<span class="sd">        smiles_column (str, optional): column heading of the smiles column. Defaults to &quot;smiles&quot;.</span>
<span class="sd">        labels_column (str, optional): column heading of the label column i.e. the identifier for each molecule. Defaults to &quot;labels&quot;.</span>
<span class="sd">        output_filename (str, optional): a name without and extension (i.e. no .xyz) to use to save the files to. Defaults to &quot;data&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None - saves files for future use</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">output_filename</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;ouput filename given with extension. We will remove the extension and save the files using the required extensions&quot;</span>
        <span class="p">)</span>
        <span class="n">output_filename</span> <span class="o">=</span> <span class="n">output_filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># load the data</span>
    <span class="n">raw_df</span> <span class="o">=</span> <span class="n">prep</span><span class="o">.</span><span class="n">load_csv_data</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>

    <span class="c1"># Prepare the data as smiles file for fragmentation</span>
    <span class="n">smi_df</span> <span class="o">=</span> <span class="n">prep</span><span class="o">.</span><span class="n">extract_smiles_and_labels</span><span class="p">(</span>
        <span class="n">raw_df</span><span class="p">,</span> <span class="n">smiles_col</span><span class="o">=</span><span class="n">smiles_column</span><span class="p">,</span> <span class="n">labels_col</span><span class="o">=</span><span class="n">labels_column</span><span class="p">,</span> <span class="n">valid_only</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">smi_df</span><span class="p">[[</span><span class="n">smiles_column</span><span class="p">,</span> <span class="n">labels_column</span><span class="p">]]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.smi&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="c1"># Make the fragment file</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">make_fragements</span><span class="p">(</span>
        <span class="n">input_filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.smi&quot;</span><span class="p">,</span>
        <span class="n">output_filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.fragdb&quot;</span><span class="p">,</span>
        <span class="n">number_of_cuts</span><span class="o">=</span><span class="n">number_of_cuts</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># setup and create the fragment database</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">make_fragements_db</span><span class="p">(</span>
        <span class="n">input_filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.fragdb&quot;</span><span class="p">,</span>
        <span class="n">output_filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">indexing_output_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">output_format</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indexing_output_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">indexing_output_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
        <span class="n">tmp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">indexing_output_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">tmp_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;smiles 1&quot;</span><span class="p">,</span> <span class="s2">&quot;smiles 2&quot;</span><span class="p">,</span> <span class="s2">&quot;id 1&quot;</span><span class="p">,</span> <span class="s2">&quot;id 2&quot;</span><span class="p">,</span> <span class="s2">&quot;v1&gt;&gt;v2&quot;</span><span class="p">,</span> <span class="s2">&quot;constant&quot;</span><span class="p">]</span>
        <span class="n">tmp_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">indexing_output_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Prepare property data files we reload the raw data file here for safety incase there is any chance the object changed from loading before</span>
    <span class="c1"># TODO: determine if the data could have changed and optimize this so we can avoid reloading if the chance is low to none</span>
    <span class="k">if</span> <span class="n">properties_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">raw_df</span> <span class="o">=</span> <span class="n">prep</span><span class="o">.</span><span class="n">load_csv_data</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">)</span>
        <span class="n">properties_df</span> <span class="o">=</span> <span class="n">prep</span><span class="o">.</span><span class="n">extract_properties</span><span class="p">(</span>
            <span class="n">raw_df</span><span class="p">,</span>
            <span class="n">properties_columns</span><span class="o">=</span><span class="n">properties_columns</span><span class="p">,</span>
            <span class="n">smiles_col</span><span class="o">=</span><span class="n">smiles_column</span><span class="p">,</span>
            <span class="n">labels_col</span><span class="o">=</span><span class="n">labels_column</span><span class="p">,</span>
            <span class="n">valid_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">properties_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;properties_</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">add_properties</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;properties_</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.mmpdb&quot;</span><span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;MMP set up completed. MMP database: </span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.mmpdb with properties included&quot;</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;MMP set up completed. MMP database: </span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.mmpdb without properties included&quot;</span>
        <span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>



  </section>
</article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Generated by <a href="https://github.com/timothycrosley/pdocs">pdocs 1.2.0</a>
    </p>
  </footer>
</div>
</body>
</html>
